# 文本格式化功能说明

## ✅ 新增功能

### 1. **浮动工具栏位置优化** 📍

**改进**：
- ✅ 工具栏现在显示在**鼠标下方 20px**
- ✅ 跟随鼠标移动时保持在下方
- ✅ 不会遮挡正在编辑的内容

**位置计算**：
```typescript
setToolbarPosition({
  x: e.clientX,
  y: e.clientY + 20  // 鼠标下方 20px
});
```

---

### 2. **文本格式化工具栏** ✨ 全新功能

**触发方式**：
1. 在输入框中选中文字
2. 格式化工具栏自动出现在选中文字下方
3. 点击格式按钮应用样式

**支持的格式**：

#### 粗体 (Bold)
- **图标**：B
- **语法**：`**文字**`
- **效果**：**粗体文字**

#### 斜体 (Italic)
- **图标**：I
- **语法**：`*文字*`
- **效果**：*斜体文字*

#### 下划线 (Underline)
- **图标**：U
- **语法**：`<u>文字</u>`
- **效果**：<u>下划线文字</u>

#### 荧光笔 (Highlight)
- **图标**：🖍️
- **语法**：`==文字==`
- **效果**：==高亮文字==（黄色背景）
- **颜色**：亮色模式黄色，暗色模式深黄色

---

## 🎯 使用方法

### 应用文本格式

1. **选中文字**
   - 在输入框中输入文字
   - 用鼠标拖动选中要格式化的文字
   - 或双击选中单词

2. **选择格式**
   - 格式化工具栏自动出现在选中文字下方
   - 点击对应的格式按钮：
     - **B** - 粗体
     - **I** - 斜体
     - **U** - 下划线
     - **🖍️** - 荧光笔

3. **查看效果**
   - 格式标记会添加到文字周围
   - 例如：选中"重要"，点击粗体 → `**重要**`

### 使用操作工具栏

1. **显示工具栏**
   - 将鼠标移到任意节点上
   - 停留 1 秒
   - 工具栏出现在**鼠标下方**

2. **使用功能**
   - 工具栏跟随鼠标移动
   - 点击需要的操作按钮
   - 工具栏自动消失

---

## 📝 格式语法说明

### Markdown 风格

应用格式后，文本会包含特殊标记：

```
**粗体文字**        → 粗体
*斜体文字*          → 斜体
<u>下划线文字</u>   → 下划线
==高亮文字==        → 黄色背景
```

### 组合使用

可以组合多种格式：

```
**==重要内容==**    → 粗体 + 高亮
*<u>强调文字</u>*   → 斜体 + 下划线
```

---

## 🎨 视觉效果

### 格式化工具栏样式
- **背景**：白色/深色（跟随主题）
- **边框**：浅灰色
- **阴影**：xl 级别阴影
- **按钮**：悬停时背景变色
- **荧光笔按钮**：黄色主题

### 工具栏位置
- **操作工具栏**：鼠标下方 20px
- **格式工具栏**：选中文字下方 5px
- **居中对齐**：工具栏中心对齐选中文字

---

## 🔧 技术实现

### 文本选择检测

```typescript
const handleTextSelect = () => {
  const input = inputRef.current;
  const start = input.selectionStart;
  const end = input.selectionEnd;
  
  if (start !== end) {
    // 有选中文字，显示格式工具栏
    setShowFormatToolbar(true);
  }
};
```

### 格式应用

```typescript
const applyFormat = (format: 'bold' | 'italic' | 'underline' | 'highlight') => {
  const before = content.substring(0, start);
  const selected = content.substring(start, end);
  const after = content.substring(end);
  
  let formatted = '';
  switch (format) {
    case 'bold':
      formatted = `${before}**${selected}**${after}`;
      break;
    // ... 其他格式
  }
  
  updateContent(nodeId, formatted);
};
```

---

## 📊 测试清单

### 浮动工具栏位置
- [ ] 悬停节点 1 秒后工具栏出现
- [ ] 工具栏在鼠标下方 20px
- [ ] 工具栏跟随鼠标移动
- [ ] 工具栏不遮挡编辑内容

### 文本格式化
- [ ] 选中文字后格式工具栏出现
- [ ] 格式工具栏在选中文字下方
- [ ] 点击粗体按钮添加 `**`
- [ ] 点击斜体按钮添加 `*`
- [ ] 点击下划线按钮添加 `<u></u>`
- [ ] 点击荧光笔按钮添加 `==`
- [ ] 格式标记正确包裹选中文字
- [ ] 应用格式后工具栏消失

### 交互体验
- [ ] 选中文字时不失去焦点
- [ ] 格式工具栏可以点击
- [ ] 应用格式后光标位置正确
- [ ] 可以连续应用多种格式

---

## 💡 使用技巧

### 快速格式化
1. 双击选中单词
2. 点击格式按钮
3. 继续编辑

### 批量格式化
1. 选中多个词
2. 应用格式
3. 所有选中内容都会被格式化

### 取消格式
- 手动删除格式标记（`**`、`*`、`<u></u>`、`==`）
- 或重新选中文字应用新格式

---

## 🚀 访问应用

应用运行在: **http://localhost:5200**

### 测试步骤

1. **测试工具栏位置**
   - 悬停在节点上
   - 确认工具栏在鼠标下方

2. **测试文本格式化**
   - 输入一些文字
   - 选中部分文字
   - 点击格式按钮
   - 查看格式标记是否正确添加

3. **测试所有格式**
   - 粗体：`**文字**`
   - 斜体：`*文字*`
   - 下划线：`<u>文字</u>`
   - 荧光笔：`==文字==`

---

## 🎉 完成状态

所有功能已实现：
- ✅ 浮动工具栏在鼠标下方
- ✅ 选中文字显示格式工具栏
- ✅ 支持粗体、斜体、下划线
- ✅ 支持荧光笔高亮
- ✅ 格式标记自动添加

开始使用新的文本格式化功能！✨

